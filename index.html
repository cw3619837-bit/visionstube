<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoTube Pro - Big Company Edition</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --yt-red: #ff0000; --bg: #0f0f0f; --card-bg: #1a1a1a; --gray-text: #aaaaaa; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background: var(--bg); color: white; overflow-x: hidden; }

        /* --- SKELETON ANIMATION --- */
        @keyframes shimmer { 0% { background-position: -468px 0; } 100% { background-position: 468px 0; } }
        .skeleton { background: #222; background-image: linear-gradient(90deg, #222 0%, #333 50%, #222 100%); background-size: 800px 104px; animation: shimmer 1.5s infinite linear; border-radius: 12px; }

        /* --- LOGIN OVERLAY --- */
        #login-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: #1e1e1e; padding: 40px; border-radius: 15px; text-align: center; width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .logo-big { color: var(--yt-red); font-size: 36px; font-weight: bold; margin-bottom: 10px; }

        /* --- NAVBAR --- */
        .nav { display: none; justify-content: space-between; align-items: center; padding: 10px 20px; background: var(--bg); border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        .logo { color: var(--yt-red); font-size: 22px; font-weight: bold; cursor: pointer; text-decoration: none; }
        .search-bar { flex-grow: 0.4; display: flex; background: #121212; border: 1px solid #333; border-radius: 20px; padding: 5px 15px; }
        .search-bar input { background: transparent; border: none; color: white; width: 100%; outline: none; padding: 5px; }
        .btn-create { background: var(--yt-red); color: white; border: none; padding: 8px 18px; border-radius: 20px; font-weight: bold; cursor: pointer; }

        /* --- LAYOUT --- */
        .layout { display: none; }
        .sidebar { width: 240px; padding: 10px; height: 100vh; position: fixed; border-right: 1px solid #333; }
        .sidebar-item { padding: 12px; border-radius: 10px; cursor: pointer; transition: 0.2s; }
        .sidebar-item:hover { background: #272727; }
        .content { margin-left: 260px; padding: 20px; width: 100%; }

        /* --- VIDEO GRID --- */
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(310px, 1fr)); gap: 20px; }
        .v-card { cursor: pointer; transition: transform 0.2s; }
        .v-card:hover { transform: scale(1.02); }
        .v-thumb { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; margin-bottom: 10px; position: relative; }
        iframe { width: 100%; height: 100%; border: none; }
        .v-info h3 { font-size: 16px; margin: 0; line-height: 1.4; }
        .v-info p { color: var(--gray-text); font-size: 14px; margin: 4px 0; }

        /* --- GOOGLE BUTTON --- */
        .g-btn { background: white; color: black; border: none; padding: 12px; border-radius: 5px; width: 100%; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <div class="logo-big">VideoTube</div>
            <p style="color:#aaa; margin-bottom: 30px;">Connect your Google Drive to start uploading and watching videos.</p>
            <button class="g-btn" id="login-btn">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="18">
                Sign in with Google
            </button>
        </div>
    </div>

    <nav class="nav" id="mainNav">
        <a href="#" class="logo">VideoTube</a>
        <div class="search-bar"><input type="text" placeholder="Search"></div>
        <div>
            <input type="file" id="fileInput" style="display:none" accept="video/*">
            <button class="btn-create" onclick="document.getElementById('fileInput').click()">+ CREATE</button>
        </div>
    </nav>

    <div class="layout" id="mainLayout">
        <aside class="sidebar">
            <div class="sidebar-item">üè† Home</div>
            <div class="sidebar-item">ü©≥ Shorts</div>
            <div class="sidebar-item">üîî Subscriptions</div>
            <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
            <div class="sidebar-item">üìú History</div>
        </aside>

        <main class="content">
            <h2 id="status">Recommended</h2>
            <div class="video-grid" id="videoGrid">
                <div class="v-card"><div class="v-thumb skeleton"></div><div class="skeleton" style="height:20px; width:80%;"></div></div>
                <div class="v-card"><div class="v-thumb skeleton"></div><div class="skeleton" style="height:20px; width:80%;"></div></div>
            </div>
        </main>
    </div>

    <script>
        const CLIENT_ID = '290145802893-bm8ukopt87c6r9o6bmva8lmdcm8vkth3.apps.googleusercontent.com';
        let accessToken = null;

        window.onload = () => {
            const client = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/drive.file',
                callback: (tokenResponse) => {
                    accessToken = tokenResponse.access_token;
                    document.getElementById('login-overlay').style.display = 'none';
                    document.getElementById('mainNav').style.display = 'flex';
                    document.getElementById('mainLayout').style.display = 'flex';
                    loadInitialVideos();
                },
            });
            document.getElementById('login-btn').onclick = () => client.requestAccessToken();
        };

        // NEW: This makes the video public so it plays for everyone immediately
        async function makeFilePublic(fileId) {
            await fetch(`https://www.googleapis.com/drive/v3/files/${fileId}/permissions`, {
                method: 'POST',
                headers: new Headers({
                    'Authorization': 'Bearer ' + accessToken,
                    'Content-Type': 'application/json'
                }),
                body: JSON.stringify({
                    'role': 'reader',
                    'type': 'anyone'
                })
            });
        }

        function loadInitialVideos() {
            const grid = document.getElementById('videoGrid');
            grid.innerHTML = `
                <div class="v-card">
                    <div class="v-thumb">
                        <iframe src="https://drive.google.com/file/d/1kze5f0wzLDsKgOkCxfPxYGbVQzgYhWOC/preview"></iframe>
                    </div>
                    <div class="v-info">
                        <h3>My First Google Drive Video</h3>
                        <p>Big Company ‚Ä¢ 1.2M views ‚Ä¢ 2 hours ago</p>
                    </div>
                </div>
            `;
        }

        document.getElementById('fileInput').onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            document.getElementById('status').innerText = "Uploading and Unlocking... (" + file.name + ")";
            
            const metadata = { name: file.name, mimeType: file.type };
            const formData = new FormData();
            formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            formData.append('file', file);

            try {
                // 1. Upload Video
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                    body: formData
                });
                const data = await response.json();
                
                // 2. AUTO-UNLOCK (Permission Change)
                await makeFilePublic(data.id);

                // 3. Update Grid
                const newVideo = `
                    <div class="v-card">
                        <div class="v-thumb">
                            <iframe src="https://drive.google.com/file/d/${data.id}/preview"></iframe>
                        </div>
                        <div class="v-info">
                            <h3>${file.name}</h3>
                            <p>My Channel ‚Ä¢ Processing... (Wait a moment)</p>
                        </div>
                    </div>
                `;
                document.getElementById('videoGrid').insertAdjacentHTML('afterbegin', newVideo);
                document.getElementById('status').innerText = "Recommended";
            } catch (err) {
                alert("Error: " + err);
                console.error(err);
            }
        };
    </script>
</body>
</html>
