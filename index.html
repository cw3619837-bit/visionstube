<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoTube Pro</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --yt-red: #ff0000; --bg: #0f0f0f; --card-bg: #1a1a1a; --gray-text: #aaaaaa; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background: var(--bg); color: white; overflow-x: hidden; }
        .nav { display: none; justify-content: space-between; align-items: center; padding: 10px 20px; background: var(--bg); border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        .logo { color: var(--yt-red); font-size: 22px; font-weight: bold; cursor: pointer; text-decoration: none; }
        #login-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: #1e1e1e; padding: 40px; border-radius: 15px; text-align: center; width: 350px; }
        .layout { display: none; }
        .sidebar { width: 240px; padding: 10px; height: 100vh; position: fixed; border-right: 1px solid #333; }
        .content { margin-left: 260px; padding: 20px; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(310px, 1fr)); gap: 20px; }
        .v-card { cursor: pointer; background: #1a1a1a; padding: 10px; border-radius: 12px; }
        .v-thumb { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 8px; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; }
        .btn-create { background: var(--yt-red); color: white; border: none; padding: 8px 18px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        .g-btn { background: white; color: black; border: none; padding: 12px; border-radius: 5px; width: 100%; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h1 style="color:red">VideoTube</h1>
            <button class="g-btn" id="login-btn">Sign in with Google</button>
        </div>
    </div>

    <nav class="nav" id="mainNav">
        <a href="#" class="logo">VideoTube</a>
        <button class="btn-create" onclick="document.getElementById('fileInput').click()">+ CREATE</button>
        <input type="file" id="fileInput" style="display:none" accept="video/*">
    </nav>

    <div class="layout" id="mainLayout">
        <aside class="sidebar">
            <div style="padding:10px">üè† Home</div>
            <div style="padding:10px">üìú History</div>
        </aside>
        <main class="content">
            <h2 id="status">Your Videos</h2>
            <div class="video-grid" id="videoGrid"></div>
        </main>
    </div>

    <script>
        const CLIENT_ID = '290145802893-bm8ukopt87c6r9o6bmva8lmdcm8vkth3.apps.googleusercontent.com';
        let accessToken = null;

        window.onload = () => {
            const client = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/drive.file',
                callback: (tokenResponse) => {
                    accessToken = tokenResponse.access_token;
                    showApp();
                },
            });
            document.getElementById('login-btn').onclick = () => client.requestAccessToken();
        };

        function showApp() {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('mainNav').style.display = 'flex';
            document.getElementById('mainLayout').style.display = 'flex';
            renderSavedVideos();
        }

        async function makeFilePublic(fileId) {
            await fetch(`https://www.googleapis.com/drive/v3/files/${fileId}/permissions`, {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + accessToken, 'Content-Type': 'application/json' },
                body: JSON.stringify({ 'role': 'reader', 'type': 'anyone' })
            });
        }

        function renderSavedVideos() {
            const saved = JSON.parse(localStorage.getItem('myVideos') || '[]');
            const grid = document.getElementById('videoGrid');
            grid.innerHTML = saved.map(v => `
                <div class="v-card">
                    <div class="v-thumb">
                        <iframe src="https://drive.google.com/file/d/${v.id}/preview"></iframe>
                    </div>
                    <h3>${v.name}</h3>
                </div>
            `).join('');
        }

        document.getElementById('fileInput').onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            document.getElementById('status').innerText = "Uploading... Do not refresh!";

            const metadata = { name: file.name, mimeType: file.type };
            const formData = new FormData();
            formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            formData.append('file', file);

            try {
                const resp = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + accessToken },
                    body: formData
                });
                const data = await resp.json();
                await makeFilePublic(data.id);

                // SAVE TO LOCAL STORAGE
                const saved = JSON.parse(localStorage.getItem('myVideos') || '[]');
                saved.unshift({ id: data.id, name: file.name });
                localStorage.setItem('myVideos', JSON.stringify(saved));

                renderSavedVideos();
                document.getElementById('status').innerText = "Done! (Video is processing in Drive)";
            } catch (err) { alert("Error: " + err); }
        };
    </script>
</body>
</html>
